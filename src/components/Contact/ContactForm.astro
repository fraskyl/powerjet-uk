---
// src/components/Contact/ContactForm.astro
interface Props {
  enableHoneypot?: boolean;
  requirePhone?: boolean;
  requireCompany?: boolean;
  successMessage?: string;
}

const { 
  enableHoneypot = true, 
  requirePhone = false,
  requireCompany = false,
  successMessage = "Thank you for your message!"
} = Astro.props;
---

<form class="contact-form" method="POST" action="/api/contact">
  <div class="form-row">
    <div class="form-group">
      <label for="name">Name *</label>
      <input type="text" id="name" name="name" required />
    </div>
    
    <div class="form-group">
      <label for="email">Email *</label>
      <input type="email" id="email" name="email" required />
    </div>
  </div>
  
  <div class="form-row">
    {requirePhone && (
      <div class="form-group">
        <label for="phone">Phone {requirePhone ? '*' : ''}</label>
        <input 
          type="tel" 
          id="phone" 
          name="phone" 
          required={requirePhone}
        />
      </div>
    )}
    
    {requireCompany && (
      <div class="form-group">
        <label for="company">Company {requireCompany ? '*' : ''}</label>
        <input 
          type="text" 
          id="company" 
          name="company" 
          required={requireCompany}
        />
      </div>
    )}
  </div>
  
  <div class="form-group">
    <label for="subject">Subject *</label>
    <input type="text" id="subject" name="subject" required />
  </div>
  
  <div class="form-group">
    <label for="message">Message *</label>
    <textarea id="message" name="message" rows="6" required></textarea>
  </div>
  
  <!-- Honeypot (hidden from users, catches bots) -->
  {enableHoneypot && (
    <input 
      type="text" 
      name="website" 
      style="display:none" 
      tabindex="-1" 
      autocomplete="off"
      aria-hidden="true"
    />
  )}
  
  <button type="submit" class="submit-btn">
    Send Message
  </button>
  
  <div class="form-message" data-success-message={successMessage}></div>
</form>

<script>
  document.querySelectorAll('.contact-form').forEach(form => {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formElement = e.target as HTMLFormElement;
      const messageDiv = formElement.querySelector('.form-message') as HTMLElement;
      const submitBtn = formElement.querySelector('.submit-btn') as HTMLButtonElement;
      const successMessage = messageDiv.getAttribute('data-success-message') || 'Thank you!';
      
      // Disable button during submission
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';
      
      try {
        const formData = new FormData(formElement);
        const response = await fetch('/api/contact', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          messageDiv.textContent = successMessage;
          messageDiv.className = 'form-message success';
          formElement.reset();
        } else {
          throw new Error('Failed to send');
        }
      } catch (error) {
        messageDiv.textContent = 'Sorry, there was an error sending your message. Please try again.';
        messageDiv.className = 'form-message error';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    });
  });
</script>

<style>
  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    max-width: 800px;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  label {
    font-weight: 500;
    color: var(--pj_blue_90);
  }
  
  input, textarea {
    padding: 0.75rem;
    border: 1px solid var(--pj_blue_30);
    border-radius: 0.25rem;
    font-family: inherit;
    font-size: 1rem;
    transition: border-color 0.3s;
  }
  
  input:focus, textarea:focus {
    outline: none;
    border-color: var(--pj_brand_blue);
  }
  
  .submit-btn {
    padding: 0.75rem 2rem;
    background-color: var(--pj_brand_blue);
    color: white;
    border: none;
    border-radius: 100px;
    cursor: pointer;
    font-weight: 500;
    font-size: 1rem;
    transition: background-color 0.3s;
    justify-self: start;
  }
  
  .submit-btn:hover:not(:disabled) {
    background-color: var(--pj_blue_90);
  }
  
  .submit-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  
  .form-message {
    padding: 1rem;
    border-radius: 0.25rem;
    display: none;
  }
  
  .form-message.success {
    display: block;
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  
  .form-message.error {
    display: block;
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }
  
  @media screen and (min-width: 768px) {
    .form-row {
      grid-template-columns: 1fr 1fr;
    }
  }
</style>