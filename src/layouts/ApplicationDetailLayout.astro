---
import "../styles/global.css";

import BaseLayout from "./BaseLayout.astro";
import Footer from "../components/Layout/Footer.astro";
import Header from "../components/Layout/Header.astro";
import SectionTitle from "../components/Content/SectionTitle.astro";
import ContactBlock from "../components/Sections/ContactBlock.astro";
import ContentBlock from "../components/Sections/ContentBlock.astro";
import Card from "../components/UI/Card.astro";
import ProductImage from "../components/Product/ProductImage.astro"
import RichText from "../components/Content/RichText.astro";

interface Props {
    title: string;
    application: {
        title: string;
        slug: string;
        lede?: string;
        description?: any; // PortableText content
        imageUrl: string;
        imageAlt: string;
        images?: Array<{
            url: string;
            alt: string;
            caption?: string;
        }>;
        recommendedProducts?: Array<{
            title: string;
            slug: string;
            imageUrl: string;
            imageAlt: string;
        }>;
    };
}

const { title, application } = Astro.props;

// Provide fallback values for development
const appTitle = application?.title || "Application";
const appLede = application?.lede || "";
const appDescription = application?.description || null;

// Handle both new images array and legacy single image
let appImages = application?.images || [];
if (appImages.length === 0 && application?.imageUrl) {
    // Backwards compatibility: convert single image to array
    appImages = [{
        url: application.imageUrl,
        alt: application.imageAlt || "Application image"
    }];
}

const appRecommendedProducts = application?.recommendedProducts || [];

---

<BaseLayout title={title}>
    <Header />
    <body>
        <div class="page-grid">
            <div class="link__prev-page-wrapper">
                <a href="/applications">
                    <div class="link__prev-page">
                        <span class="material-symbols-outlined">arrow_back</span
                        >
                        <p>Back to applications</p>
                    </div>
                </a>
            </div>

           <div class="section__applications-wrapper">
                <!-- Image Gallery Section -->
                <div class="section__applications-gallery">
                    <ProductImage images={appImages} />
                </div>

                <!-- Application Info Section -->
                <div class="section__applications-info">
                    <div class="application-header">
                        <h1>{appTitle}</h1>
                        {appLede && (
                            <p class="application-lede">{appLede}</p>
                        )}
                    </div>

                    {appDescription && (
                        <div class="application-description">
                            <RichText value={appDescription} className="prose-slate" />
                        </div>
                    )}
                </div>
            </div>


            {
                appRecommendedProducts.length > 0 && (
                <div class="divider__border"></div>
                    <section class="section__applications-recommended-products">
                        <div class="section__applications-recommended-products-title">
                            <SectionTitle
                                headline="Recommended Products"
                                headingSize="small"
                            />
                        </div>
                        <div class="section__applications-recommended-products-cards">
                        {appRecommendedProducts.map((product: any) => (
                            <Card
                                imageURL={product.imageUrl}
                                imageAlt={product.imageAlt}
                                href={`/products/${product.slug}`}
                                buttonLabel={product.title}
                                icon={true}
                                style="light"
                            />
                        ))}
                    </div>
                 
                    </section>
                )
            }
            <ContactBlock />
        </div>
    </body> 
 <Footer />
 </BaseLayout>


    <style>
        .link__prev-page-wrapper {
            grid-column: 2 / -2; /* âœ… Added: Position in grid */
            display: flex;
            margin-bottom: 3rem;
            margin-top: 3rem;
        }

        .link__prev-page-wrapper a {
            text-decoration: none;
            color: var(--pj_brand_blue);
        }

        .link__prev-page {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 0.5rem;
        }

        .section__applications-wrapper {
        grid-column: 2 / -2;
        display: flex;
        flex-direction: column;
        margin-bottom: 3rem;
        gap: 2rem;
    }

    .section__applications-gallery {
        width: 100%;
    }

    .section__applications-info {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .application-header h1 {
        font-weight: 450;
        font-size: 1.6rem;
        color: var(--pj_blue_80);
        margin: 0 0 0.5rem 0;
    }

    .application-lede {
        font-size: 1.25rem;
        line-height: 1.4;
        color: var(--pj_blue_70);
        margin: 0;
    }

    .application-description {
        width: 100%;
    }

    .section__applications-recommended-products {
        display: flex;
        flex-direction: column;
        grid-column: 2 / -2;
        margin-bottom: 7.75rem;
    }

    .section__applications-recommended-products-cards {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        grid-column: 2 / -2;
    }

    .divider__border {
        margin-bottom: 1rem;
        height: 100%;
    }

    @media screen and (min-width: 768px) {
        .link__prev-page-wrapper {
            display: flex;
            height: 100%;
            margin-bottom: 3rem;
            margin-top: 3rem;
            grid-column: 2 / -2;
        }

        .divider__border {
            grid-column: 2 /-2;
        }

        .section__applications-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            grid-column: 2 / -2;
            margin-bottom: 5rem;
        }

        .section__applications-gallery {
            grid-column: 1;
        }

        .section__applications-info {
            grid-column: 2;
        }

        .application-header h1 {
            font-size: 2rem;
        }

        .section__applications-recommended-products {
            display: grid;
            grid-template-columns: 1fr;
            grid-column: 2 / -2;
            margin-bottom: 5rem;
            gap: 1rem;
        }

        .section__applications-recommended-products-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            grid-column: 2 / -2;
            margin-bottom: 4rem;
        }
    }

    @media screen and (min-width: 1024px) {
        .link__prev-page-wrapper {
            grid-column: 3 / -3;
            margin-bottom: 5rem;
        }

        .section__applications-wrapper {
            grid-column: 3 / -3;
            gap: 4rem;
            margin-bottom: 5rem;
        }

        .divider__border {
            grid-column: 3 /-3;
        }

        .section__applications-recommended-products {
            display: grid;
            grid-column: 3 / -3;
            margin-bottom: 5rem;
        }
    }
</style>