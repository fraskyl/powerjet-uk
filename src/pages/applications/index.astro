---
import "../../styles/global.css"
import { sanityClient } from "../../lib/sanity";
import { applicationsIndexQuery } from "../../lib/queries";

import Footer from "../../components/Layout/Footer.astro";
import Header from "../../components/Layout/Header.astro";
import TextHero from "../../components/Sections/TextHero.astro";
import Card from "../../components/UI/Card.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

import Divider from "../../components/UI/Divider.astro";

// Fetch all applications from Sanity
let applications = [];
let fetchError = false;

try {
    applications = await sanityClient.fetch(applicationsIndexQuery);
    console.log("✅ Fetched applications:", applications?.length || 0);
} catch (error) {
    console.error("❌ Sanity fetch error:", error);
    fetchError = true;
}

const title = "Applications | Powerjet";
---

<BaseLayout title={title}>
    <Header />
    <body>
        <div class="page-grid">
            <TextHero
                headline="Applications"
                subheadline="We can provide experienced operators — fully qualified with WJA — for offshore, onshore and overseas workscope. This is particularly beneficial for ensuring product optimisation."
            />



              <div class="section__applications">
                <div class="section__applications-cards">
                    {fetchError ? (
                        <div class="error-message">
                            <p>Unable to load applications. Please try again later.</p>
                        </div>
                    ) : applications.length > 0 ? (
                        applications.map((app: any) => (
                            <Card
                                imageURL={app.imageUrl}
                                imageAlt={app.imageAlt}
                                href={`/applications/${app.slug}`}
                                buttonLabel={app.title}
                                icon={true}
                            />
                        ))
                    ) : (
                        <div class="empty-state">
                            <p>No applications available yet. Check back soon!</p>
                        </div>
                    )}
                </div>
            </div>
        </div>
    </body>
    <Footer />
</BaseLayout>

    <style>
        .section__applications {
            display: grid;
            grid-template-columns: 1fr;
            grid-column: 2 / -2;
            margin-bottom: 7.75rem;
        }

        .section__applications-cards {
            display: grid;
            grid-template-columns: 1fr;
            grid-column: 2 / -2;

            gap: 2rem;
        }

	@media screen and (min-width: 768px) {
         .section__applications {
            display: grid;
            grid-template-columns:1fr;
            grid-column: 2 / -2;
            margin-bottom: 7.75rem;
        }

        .section__applications-cards {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 2rem;
        }
    }

       

    </style>
</html>
