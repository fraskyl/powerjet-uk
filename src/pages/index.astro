---
import Homepage from "../layouts/Homepage.astro";
import CTABanner from "../components/CTABanner.astro";
import TextBlock from "../components/TextBlock.astro";
import Card from "../components/Card.astro";
import SectionTitle from "../components/SectionTitle.astro";
import Divider from "../components/Divider.astro";
import { sanityClient } from "../lib/sanity";
import { homepageQuery } from "../lib/queries";

import HomepageHero from "../components/HomepageHero.astro";

//Fetch homepage data from Sanity
let homepage; 
try {
	homepage = await sanityClient.fetch(homepageQuery);
	console.log("Fetched from Sanity:", homepage);
}
catch (error) {
	console.error("Sanity fetch error", error);
}


// Fallback if Sanity data no available -- change video to image backup?
const heroHeadline = homepage?.heroHeadline || "High-Pressure and Ultra High-Pressure Water Jetting Equipment";
const heroVideoUrl = homepage?.heroVideoUrl || "/src/assets/PJ-Quick-Edit-for-web-mockup.mp4";

const productSectionTitle = homepage?.productSectionHeadline || "Discover our products";
const productSectionDescription = homepage?.productSectionDescription || "We offer a  comprehensive fleet of High-Pressure (HP) and Ultra-High Pressure (UHP) jetting units, complemented by specialised accessories.";
const productCards = homepage?.productCards || [];

const ctaBanner = homepage?.ctaBanner;

const aboutText = homepage?.aboutText || "For over 20 years, Powerjet has been a trusted supplier...";
const partnerLogos = homepage?.partnerLogos || [];
---

<Homepage title="Powerjet Rentals UK">

	<HomepageHero 
		slot ="hero"
		headline = {heroHeadline}
		videoUrl= {heroVideoUrl}
		/>



	<div class="section__product">
		<div class="section__product__text">
			<SectionTitle
				Headline={productSectionTitle}
				HeadingSize="regular"
			/>
			<TextBlock
				BodyCopy={productSectionDescription}
			/>
		</div>

		<div class="section__product__cards">
			 {productCards.length > 0 ? (
                productCards.map((card: any) => (
                    <Card
                        imgSrc={card.imageUrl}
                        imgAlt={card.imageAlt}
                        hrefLink={card.link}
                        buttonLabel={card.title}
                    />
                ))
            ) : (
                <!-- Fallback: Show default cards if CMS not set up yet -->
                <Card
                    imgSrc="/src/assets/New_Image_Magtrack-lrg.jpeg"
                    imgAlt="Equipment"
                    hrefLink="/rentals"
                    buttonLabel="Rentals"
                />
                <Card
                    imgSrc="/src/assets/New_Image_Magtrack-lrg.jpeg"
                    imgAlt="Equipment"
                    hrefLink="/sales"
                    buttonLabel="Sales"
                />
            )}
        </div>
	</div>
	<!-- <ApplicationCarousel />  -->
	<!-- CTA Banner - Now from CMS -->
    {ctaBanner ? (
        <CTABanner
            headline={ctaBanner.headline}
            bodyCopy={ctaBanner.bodyCopy}
            buttonLabel={ctaBanner.buttonText}
            buttonLink={ctaBanner.buttonLink}
            imageUrl={ctaBanner.imageUrl}
            imageAlt={ctaBanner.imageAlt}
        />
    ) : (
        <!-- Fallback: Default CTA if not set in CMS -->
        <CTABanner />
    )}

	<Divider />
	<section class="section__about-us ">
		<SectionTitle Headline={homepage?.aboutHeadline || "About us"} HeadingSize="small" />
		<TextBlock
			BodyCopy={aboutText}
			fontSize="large"
		/>
	</section>
	<section class="section__partner-logo span-full">
		<SectionTitle Headline="Proud to partner with" HeadingSize="small" />
		 <div class="grid__partner-logo-wrapper">
      {partnerLogos.length > 0 ? (
        partnerLogos.map((logo: any) => (
          <div class="grid__partner-logo">
            {logo.partnerUrl ? (
              <a href={logo.partnerUrl} target="_blank" rel="noopener">
                <img src={logo.url} alt={logo.alt} />
              </a>
            ) : (
              <img src={logo.url} alt={logo.alt} />
            )}
          </div>
        ))
      ) : (
        <!-- Fallback to existing hardcoded logos -->
        <div class="grid__partner-logo">
          <img src="/src/assets/logos/partners/jetstream-logo-color.png" />
        </div>
        <!-- ... rest of hardcoded logos ... -->
      )}
    </div>
	</section>
</Homepage>

<style>
	.section__product {
		grid-column: 2 / -2;
		display: grid;
		grid-template-columns: subgrid;
		gap: 1.5rem;
		margin-bottom: 7.75rem;
	}

	.section__product__text {
		grid-column: 1 / -1;	
	}

	.section__product__cards {
		grid-column: 1 / -1;
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.section__about-us {
		grid-column: 2 / -2;
		display: flex;
		flex-direction: column;
		margin-bottom: 7.75rem;
	}

	.section__partner-logo {
		display: flex;
		flex-direction: column;
		text-align: center;
		align-items: center;
		margin-top: 2rem;
		margin-bottom: 7.75rem;
		gap: 3rem;
		padding: 0 1rem; /* Add horizontal padding for mobile */
	}


	.grid__partner-logo-wrapper {
		display: flex;
		flex-wrap: wrap;
		justify-content: center;
        gap: 2rem;
        width: 100%;
		max-width: 100%;  /* Prevent overflow */
	}

	.grid__partner-logo {
		display: flex;
		align-items: center;
        justify-content: center;
		width: 100%;
		height: fit-content;
		overflow: hidden; /* Hides SVG padding */
		flex-shrink: 0;
	}


	.grid__partner-logo img {
		display: block;
		object-fit: contain;
		width: auto;
		height: 4rem;
		max-width: 100%;
	}

	 /* SVG-specific sizing */
    .grid__partner-logo svg {
        max-width: 100%;
        height: auto;
    }

	@media screen and (min-width: 768px) {
		

	.section__product__text {
		grid-column: 1 / -3;
		grid-row: 1; /* Explicitly set to row 1 */

		
	}

	.section__product__cards {
		grid-column: 1 /-1;
		grid-row: 2; /* Explicitly set to row 1 */
        flex-direction: row;
	}

	.section__about-us {
		grid-column: 2 / -2;
		display: flex;
		flex-direction: column;
		margin-bottom: 7.75rem;
	}

	 .section__partner-logo {
        padding: 0 2rem; /* More padding on tablet */
    }
    
    .grid__partner-logo-wrapper {
        gap: 3rem; /* Original gap restored */
    }
    
    .grid__partner-logo {
        width: fit-content; /* Allow multiple per row on tablet */
        max-width: calc(33.333% - 2rem); /* Three logos per row on tablet */
    }
    
    .grid__partner-logo img {
        height: 5rem; /* Original height restored */
    }

	

	}


	/* Desktop */
@media screen and (min-width: 1024px) {


	.section__product__text {
		grid-column: 1 / 7;
		grid-row: 1; /* Explicitly set to row 1 */
	}

	.section__product__cards {
		grid-column: 7 / -1;
		grid-row: 1; /* Explicitly set to row 1 */
	}
	

    .section__partner-logo {
        padding: 0; /* Can remove padding on desktop as grid margins handle it */
    }
    
    .grid__partner-logo {
        width: fit-content; /* Allow natural sizing */
        max-width: none; /* No constraint on desktop */
    }
}
</style>
