---
import "../styles/global.css";

import { sanityClient } from "../lib/sanity";
import { contactPageQuery} from "../lib/queries";

import Footer from "../components/Layout/Footer.astro";
import Header from "../components/Layout/Header.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import ContactForm from "../components/Contact/ContactForm.astro";

let contactData;

try {
	// Fetch contact information
	contactData = await sanityClient.fetch(contactPageQuery);
	console.log("✅ Contact info fetched");
} catch (error) {
	console.error("❌ Error fetching contact data:", error);
}

// === Contact info defaults ===
const phone = contactData?.phone || "+441414405757";
const phoneDisplay = contactData?.phoneDisplay || "+44 (0) 141 440 5757";
const email = contactData?.email || "mail@powerjet-uk.com";
const showEmail = contactData?.showEmailPublicly ?? false;
const address = contactData?.address;
const openingHours = contactData?.openingHours || [];
const mapUrl = contactData?.mapUrl;

// === Contact form settings ===
const enableHoneypot = contactData?.enableHoneypot ?? true;
const requirePhone = contactData?.requiredFields?.requirePhone ?? false;
const requireCompany = contactData?.requiredFields?.requireCompany ?? false;
const successMessage = contactData?.successMessage || "Thank you for your message!";

const title = "Contact | Powerjet";
---

<BaseLayout title={title}>
	<Header />
	<body>
		<div class="page-grid">
			<section class="section__contact-details">
				<div class="contact__title">
					<h1>Contact</h1>
				</div>
				<div class="divider__border"></div>
				<div class="contact__details-wrapper">
					<div class="contact__details">
						<div class="contact__details-block-wrapper">
							<div class="contact__details-block">
								<h5>Call</h5>
								<p>+44 (0) 141 440 5757</p>
							</div>
							<div class="contact__details-block">
								<h5>Email</h5>
								<p>mail@powerjet-uk.com</p>
							</div>
						</div>
						<div class="contact__details-block-wrapper">
							{
								address && (
									<div class="contact__details-address">
										<h5>Head Office</h5>
										<address>
											<p>{address.line1}</p>
											{address.line2 && (
												<p>{address.line2}</p>
											)}
											<p>{address.city}</p>
											<p>{address.postcode}</p>
											<p>{address.country}</p>
										</address>
									</div>
								)
							}
							{
								openingHours.length > 0 && (
									<div class="contact__details-opening-hours-wrapper">
										<h5>Opening Hours</h5>
										<div class="contact__details-opening-hours">
											<div class="contact__details-opening-hours-days">
												{openingHours.map(
													(item: any) => (
														<p>{item.days}:</p>
													),
												)}
											</div>
											<div class="contact__details-opening-hours-time">
												{openingHours.map(
													(item: any) => (
														<p>{item.hours}</p>
													),
												)}
											</div>
										</div>
									</div>
								)
							}
						</div>
					</div>
					<div class="contact__details-map"></div>
				</div>
			</section>

			<div class="divider__border"></div>

			<div class="section__contact-form">
				<h2>Have an equiry? Let's talk</h2>
				<ContactForm 
				enableHoneypot={enableHoneypot} 
				requirePhone={requirePhone}
				requireCompany={requireCompany}
				successMessage={successMessage}
				/>
			</div>
		</div>
	</body>
	<Footer />
</BaseLayout>

<style>
	.section__contact-details {
		display: grid;
		grid-template-columns: 1fr;
		grid-column: 2 / -2;
		gap: 1rem;
		margin-top: 4rem;
	}

	.contact__details {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	.contact__details-opening-hours {
		display: flex;
		flex-direction: row;
		gap: 1rem;
		margin-bottom: 3rem;
	}

	.section__contact-details h1 {
		font-weight: 500;
		color: var(--pj_blue_90);
	}

	.section__contact-details h5 {
		font-weight: 400;
		color: var(--pj_blue_90);
	}

	.contact__details-map {
		width: 100%;
		height: 500px;
		background-color: var(--pj_blue_10);
		border-radius: 4px;
	}

	.contact__details-block p {
		font-weight: 500;
		color: var(--pj_blue_90);
	}

	.contact__details-block-wrapper {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.contact__details-block {
		display: flex;
		padding: 16px;
		flex-direction: column;
		align-items: flex-start;
		width: max-content;
		gap: 4px;
		flex: 1 0 0;
		border-radius: 4px;
		background: var(--pj_blue_10);
	}

	.contact__details-opening-hours {
		display: flex;
		flex-direction: row;
		gap: 1rem;
	}

	@media screen and (min-width: 768px) {
		.contact__details-wrapper {
			display: flex;
			flex-direction: row;
			gap: 2rem;
		}

		.contact__details-block-wrapper {
			display: flex;
			flex-direction: row;
			gap: 1rem;
		}
	}

	@media screen and (min-width: 1024px) {
		.section__contact-details {
			display: grid;
			grid-template-columns: 1fr;
			grid-column: 2 / -2;
			gap: 1rem;
			margin-top: 4rem;
		}

		.contact__details-block {
			display: flex;
			padding: 16px;
			flex-direction: column;
			align-items: flex-start;
			width: max-content;

			gap: 4px;
			flex: 1 0 0;
			border-radius: 4px;
			background: var(--pj_blue_10);
		}
	}
</style>
